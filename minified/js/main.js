"use strict";function randomNumber(t,e){return parseInt(Math.random()*(e-t+1))+t}function randomColor(t){if(16!==t)return"rgb("+parseInt(256*Math.random())+","+parseInt(256*Math.random())+","+parseInt(256*Math.random())+")";for(var e="0123456789abcdef",n="#",r=0;r<6;r++){var a=parseInt(Math.random()*e.length);n+=e.charAt(a)}return n}var Element={filter:function(t){for(var e=[],n=0;n<t.length;n++)1===t[n].nodeType&&e.push(t[n]);return e},children:function(t){return this.filter(t.childNodes)},prev:function(t){},next:function(t){}};function getCss(t,e){return window.getComputedStyle?getComputedStyle(t)[e]:t.currentStyle?t.currentStyle[e]:t.style[e]}function bind(t,e,n,r){t.addEventListener?t.addEventListener(e,n,r):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function one(t,e,n,r){}var Cookie={get:function(t){var e=document.cookie,n="";e=e.split("; ");for(var r=0;r<e.length;r++){var a=e[r].split("=");a[0]===t&&(n=a[1])}return n},remove:function(t){var e=new Date;e.setDate(e.getDate()-1),this.set(t,"x",{expires:e})},set:function(t,e,n){var r=t+"="+e;void 0===n&&(n={}),n.expires&&(r+=";expires="+n.expires.toUTCString()),n.path&&(r+=";path="+n.path),n.domain&&(r+=";domain="+n.domain),n.secure&&(r+=";secure"),document.cookie=r}};function animate(i,t,c){var u=0;for(var e in t)u++,function(r){var a=t[r],o=r+"timer";clearInterval(i[o]),i[o]=setInterval(function(){var t=getCss(i,r),e=t.match(/^([\-\d\.]+)([a-z]*)$/);if(e){t=1*e[1],e=e[2];var n=(a-t)/10;n=n<0?Math.floor(n):Math.ceil(n),"opacity"===r&&(n=n<0?-.05:.05),(t+=n)===a&&(clearInterval(i[o]),t=a,u--,"function"==typeof c&&0===u&&c()),i.style[r]=t+e}else clearInterval(i.timer)},30)}(e)}function type(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}
"use strict";var _shim;function _defineProperty(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}require.config({paths:{jquery:"../lib/jquery-3.2.1",jxcarousel:"../lib/jx-Carousel/jquery.carousel",common:"common",bootstrapjs:"../lib/bootstrap-3.3.7-dist/js/bootstrap.min",custom:"custom",pagination:"../lib/jqueryPagination/jquery.pagination.min",ellipsis:"../lib/ellipsis/dist/jquery.ellipsis.min"},shim:(_shim={jxcarousel:["common"]},_defineProperty(_shim,"jxcarousel",["jquery"]),_defineProperty(_shim,"bootstrapjs",["jquery"]),_defineProperty(_shim,"listPage",["jquery"]),_defineProperty(_shim,"custom",["jquery"]),_defineProperty(_shim,"pagination",["jquery"]),_defineProperty(_shim,"ellipsis",["jquery"]),_shim)});
"use strict";require(["config"],function(){require(["jquery","custom","ellipsis"],function(g){g("#pageHeader").load("../html/commonHtml.html #pageHeader .container",function(){g("#pageHeader").indexs()}),g("#header_b").load("../html/commonHtml.html #header_b .container"),g("nav").load("../html/commonHtml.html nav .tab1 ",function(){g("nav").indexs()}),g("aside").load("../html/commonHtml.html aside .asideFix",function(){g("aside").indexs()}),g("footer").load("../html/commonHtml.html #pageFooter .footer_t,#pageFooter .footer_b"),{title:"h1",price:".goods_price",name:".goods_name",from:".goods_from",guoyao:".goods_num",guige:".guige",midimg:"#midimg",imageMenu:"#imageMenu",store:".store",topAnchor:".topAnchor",init:function(){var t=this;g.get("../api/details.php","id="+location.search.slice(1),function(i){t.res=JSON.parse(i)[0],t.zoomImg=JSON.parse(t.res.zoomsmall),t.ul=g("<ul/>"),t.render(t.res),t.jxzoom(t.zoomImg)}),g.get("../api/location.php",function(i){t.datas=JSON.parse(i),t.ul2=g('<ul class="clearfix"/>'),t.div=g('<div class="changeModel"/>'),t.loca(t.datas,t.datas[0]),g(t.store).on("mouseover","li",function(i){console.log(i.target),g(i.target).addClass("cur").siblings().removeClass("cur");var e=g(i.target).text();g.get("../api/location.php",{name:e},function(i){var e=JSON.parse(i);e=e[0],t.locaImg(e)})})});var i=document.cookie.split("; ");console.log(i),this.getCookie(i),g(".empty span").on("click",function(){console.log(g(".recBro")),g(".recBro").html("您已清空最近浏览过的商品");var i=new Date;i.setDate(i.getDate()-1),document.cookie="historyList="+JSON.stringify("x")+";expires="+i,document.cookie="currentGoods="+JSON.stringify("x")+";expires="+i}),g(".numBox").on("click","i",function(){var i=1*g(".addNum").val();g(this).hasClass("add_icon")?i++:g(this).hasClass("reduce_icon")&&--i<=1&&(i=1),g(".addNum").val(i)}),window.onscroll=function(){900<scrollY?(g(t.topAnchor).css("display","block"),g(".rigAnchor").css({position:"fixed",top:68,right:"10%"})):(g(t.topAnchor).css("display","none"),g(".rigAnchor").css({position:"absolute",top:40,right:0}))}},render:function(i){g(this.title).html("<i></i>"+i.goodsname),g(this.price).html("￥"+i.vip),g(this.name).html(""+i.usuallyname),g(this.from).html(""+i.makefrom),g(this.guoyao).html(""+i.agreenum),g(this.guige).html(i.guige+"<i></i>")},jxzoom:function(i){g(this.midimg).attr("src",i[0]),g(this.midimg).css({width:398,height:398}),this.ul.html(i.map(function(i){return'<li><img src="'+i+'" width="68" height="68"></li>'}).join("")),g(this.imageMenu).html(this.ul),this.ul.children(":first-child").attr("id","onlickImg"),function(i){var e=g("#imageMenu li").length-i,t=g("#imageMenu li:first").width(),s=0;g(".scrollbutton").click(function(){if(g(this).hasClass("disabled"))return!1;g(this).hasClass("smallImgUp")?--s:++s,g(".scrollbutton").removeClass("disabled"),0==s&&g(".smallImgUp").addClass("disabled"),s==e-1&&g(".smallImgDown").addClass("disabled"),g("#imageMenu ul").stop(!1,!0).animate({marginLeft:-s*t+"px"},600)}),g.fn.decorateIframe=function(i){if(void 0===document.body.style.maxHeight){var t=g.extend({},g.fn.decorateIframe.defaults,i);g(this).each(function(){var i=g(this),e=g("<iframe />");e.attr("id",t.iframeId),e.css("position","absolute"),e.css("display","none"),e.css("display","block"),e.css("z-index",t.iframeZIndex),e.css("border"),e.css("top","0"),e.css("left","0"),0==t.width&&e.css("width",i.width()+2*parseInt(i.css("padding"))+"px"),0==t.height&&e.css("height",i.height()+2*parseInt(i.css("padding"))+"px"),e.css("filter","mask(color=#fff)"),i.append(e)})}},g.fn.decorateIframe.defaults={iframeId:"decorateIframe1",iframeZIndex:-1,width:0,height:0},g("#bigView").decorateIframe();var o=null;function n(i){g("#midimg").attr("src",i).on("load",function(){h()})}function a(i){"none"==g("#winSelector").css("display")&&g("#winSelector,#bigView").show(),g("#winSelector").css(function(i){if(null==i)return;var e=g("#midimg").offset().left,t=g("#midimg").offset().top;X=i.pageX-e-r/2,Y=i.pageY-t-l/2,X=X<0?0:X,Y=Y<0?0:Y,X=X+r>c?c-r:X,Y=Y+l>m?m-l:Y,null==d&&(d=g("#bigView img").outerWidth(),$viewImgHeight=g("#bigView img").height(),(d<200||$viewImgHeight<200)&&(d=$viewImgHeight=800),$height=l*$viewImgHeight/m,g("#bigView").width(r*d/c),g("#bigView").height($height));var s=X*d/c,o=Y*$viewImgHeight/m;return g("#bigView img").css({left:-1*s,top:-1*o}),g("#bigView").css({top:15,left:g(".preview").position().left+g(".preview").width()+15}),{left:X,top:Y}}(i)),i.stopPropagation()}g("#imageMenu li img").bind("click",function(){"onlickImg"!=g(this).attr("id")&&(n(g(this).attr("src").replace("small","mid")),g("#imageMenu li").removeAttr("id"),g(this).parent().attr("id","onlickImg"))}).bind("mouseover",function(){"onlickImg"!=g(this).attr("id")&&(window.clearTimeout(o),n(g(this).attr("src").replace("small","mid")),g(this).css({border:"1px solid #f03b43"}).parent().siblings().children().css({border:"none"}))}).bind("mouseout",function(){"onlickImg"!=g(this).attr("id")&&(g(this).removeAttr("style"),o=window.setTimeout(function(){n(g("#onlickImg img").attr("src").replace("small","mid"))},1e3))}),g("#midimg").mouseover(a),g("#midimg,#winSelector").mousemove(a).mouseout(function(i){"none"!=g("#winSelector").css("display")&&g("#winSelector,#bigView").hide();i.stopPropagation()});var r=g("#winSelector").width(),l=g("#winSelector").height(),c=g("#midimg").width(),m=g("#midimg").height(),d=$viewImgHeight=$height=null;function h(){g("#bigView img").attr("src",g("#midimg").attr("src").replace("mid","big"))}h(),g("#bigView").scrollLeft(0).scrollTop(0)}(g(this.ul).children().length)},loca:function(i){this.ul2.html(i.map(function(i){return"<li>"+i.name+"</li>"}).join("")),g(this.store).append(this.ul2),this.ul2.children(":first-child").addClass("cur"),this.div.html('<img src="../images/goods/position/position (2).jpg"width="209">\n                    <div class="address">\n                        <span><i></i> 020-87613558，020-87303808</span>\n                        <span><i></i>广州市越秀区先烈南路9号101房</span>\n                    </div> '),g(".address span:last").ellipsis({row:2,char:"..."}),g(this.store).append(this.div)},locaImg:function(i){this.div.html('<img src="'+i.imgurl+'"width="209">\n                    <div class="address">\n                        <span><i></i> '+i.phone+"</span>\n                        <span><i></i>"+i.localtion+"</span>\n                    </div> "),g(".address span:last").ellipsis({row:2,char:"..."}),g(this.store).append(this.div)},getCookie:function(i){var t,s=[];i.forEach(function(i){var e=i.split("=");"currentGoods"===e[0]?t=JSON.parse(e[1]):"historyList"===e[0]&&(s=JSON.parse(e[1]))});for(var e=0;e<s.length;e++)if(s[e].id===t.id){s.splice(e,1);break}null!=t&&s.unshift(t);var o=new Date;o.setDate(o.getDate()+3),document.cookie="historyList="+JSON.stringify(s)+";expires="+o;var n=g('<ul class="clearfix"/>');n.append(s.map(function(i){return'<li>\n                    <p class="recImg"><a href="goods.html?'+i.id+'"y><img src="'+i.imgurl+'" width="100" height="100"  alt=""></a></p>\n                    <p class="recName"><a href="goods.html?'+i.id+'">'+i.name+'</a> </p>\n                    <p class="recPri">￥'+i.price+"</p>\n                    <li/>"}).join("")),console.log(n),this.$recBroUl=n,g(".recBro").append(n)}}.init()})});
"use strict";require(["config"],function(){require(["jquery","common","jxcarousel","bootstrapjs"],function(n){n(".mykdl").hover(function(){n(".mykdl ul").removeClass("hide").addClass("shows"),n(".jiantou1").removeClass("glyphicon-triangle-bottom").addClass("glyphicon-triangle-top")},function(){n(".mykdl ul").removeClass("shows").addClass("hide"),n(".jiantou1").removeClass("glyphicon-triangle-top").addClass("glyphicon-triangle-bottom")}),n(".wzdh").hover(function(){n(".wzdh div").removeClass("hide").addClass("shows"),n(".jiantou2").removeClass("glyphicon-triangle-bottom").addClass("glyphicon-triangle-top")},function(){n(".wzdh div").removeClass("shows").addClass("hide"),n(".jiantou2").removeClass("glyphicon-triangle-top").addClass("glyphicon-triangle-bottom")}),{ele:".downList",init:function(){this.ele=n(this.ele),this.ele.find("h3").on("click",function(){n(".more").is(":visible")?(n(".up").hide(),n(".more").slideUp(500,function(){n(".down").show()})):(n(".down").hide(),n(".more").slideDown(500,function(){n(".up").show()}))}),n(".up").on("click",function(){console.log(666);var i=setInterval(function(){var e=Math.ceil(window.scrollY/10);scrollBy(0,-e),0===window.scrollY&&clearInterval(i)},30)})}}.init(),n(".carousel").jxcarousel({ele:".banner_l",width:670,height:450,num:!1,index:0,page:!0,imgs:["../images/indexImg/banner/banner(1).jpg","../images/indexImg/banner/banner(2).jpg","../images/indexImg/banner/banner(3).jpg","../images/indexImg/banner/banner(4).jpg","../images/indexImg/banner/banner(5).jpg","../images/indexImg/banner/banner(6).jpg"],duration:4e3}),n.get("../api/limitBuy.php",{del:1},function(e){var i=JSON.parse(e);n(".limitBox").jxcarousel({ele:".limitBox",width:308,height:251,num:!1,index:0,page:!0,duration:3e3,button:!1,imgbox:i})}),n.ajax({type:"get",url:"../api/limitBuy.php",data:{param:"tejia"},success:function(e){var i=JSON.parse(e);n(".imgbox").html(i.map(function(e){return'<li>\n                                <a href="#"><img src="'+e.imgurl+'" width="140" ,height="140"></a>\n                                <p>'+e.name+"</p>\n                                <p>￥"+e.price+"</p>\n                            </li>"}).join(""))}}),n(".activeTab").on("mouseover","li",function(){n(this).css({background:"#f54343",color:"#fff"}).siblings().css({background:"#f9f9f9",color:"#000"}),n(this).closest(".activeTab").next().find(".secTab2").css("display","none"),n(this).closest(".activeTab").next().find(".secTab").eq(n(this).index()).children().eq(0).css("display","block");var e="tejia";n(this).hasClass("tjTab")?e="tejia":n(this).hasClass("rmTab")?e="hotSale":n(this).hasClass("rpTab")?e="evaluate":n(this).hasClass("xpTab")&&(e="newGoods"),n.ajax({type:"get",url:"../api/limitBuy.php",data:{param:e},success:function(e){var i=JSON.parse(e);n(".imgbox").html(i.map(function(e){return'<li>\n                                <a href="#"><img src="'+e.imgurl+'" width="140" ,height="140"></a>\n                                <p>'+e.name+"</p>\n                                <p>￥"+e.price+"</p>\n                            </li>"}).join(""))}})}),n(".secTab").on("mouseover","li",function(e){n(this).css({background:"#f54343",color:"#fff"}).siblings().css({background:"#f9f9f9",color:"#000"});n.ajax({type:"get",url:"../api/limitBuy.php",data:{param:"secTab"},success:function(e){var i=JSON.parse(e);n(".imgbox").html(i.map(function(e){return'<li>\n                                <a href="#"><img src="'+e.imgurl+'" width="140" ,height="140"></a>\n                                <p>'+e.name+"</p>\n                                <p>￥"+e.price+"</p>\n                            </li>"}).join(""))}})}),n("#myTab a").mouseover(function(e){e.preventDefault(),n(this).tab("show"),n(this).css("color","red").parent().siblings().children().css("color","#666")}),n(".toTop").on("click",function(e){console.log(666),e.preventDefault();var i=setInterval(function(){var e=Math.ceil(window.scrollY/10);scrollBy(0,-e),0===window.scrollY&&clearInterval(i)},30)});var a,e=document.cookie.split("; ");console.log(e),e.forEach(function(e){var i=e.split("=");console.log(i),"username"===i[0]&&(a=JSON.parse(i[1]),n(".cookieUser").html(a),n(".reg_z").hide(),n(".login_z").hide(),n(".tuichu").show())}),n(".tuichu").on("click",function(){var e=new Date;e.setDate(e.getDate()-1),document.cookie="username="+JSON.stringify("")+";expires="+e+";path=/",n(".tuichu").hide(),n(".reg_z").show(),n(".login_z").show(),n(".cookieUser").html("")})})});
"use strict";require(["config"],function(){require(["jquery","custom","bootstrapjs","pagination"],function(n){n("#pageHeader").load("../html/commonHtml.html #pageHeader .container",function(){n("#pageHeader").indexs()}),n("#header_b").load("../html/commonHtml.html #header_b .container"),n("nav").load("../html/commonHtml.html nav .tab1 ",function(){n("nav").indexs()}),n("aside").load("../html/commonHtml.html aside .asideFix",function(){n("aside").indexs()}),n("footer").load("../html/commonHtml.html #pageFooter .footer_t,#pageFooter .footer_b"),n(".item").on("click",function(){n(this).next().slideToggle(100),n(".inneritem").not(n(this).next()).slideUp("fast")});var e={list:".cont_r",otherType:".otherType",sum:".cont_rList_sum",disease:".disease",sort:".filter_l",total:".filter_ra",page:".filter_rb",pageNum:".pageNum",btnSure:".filter_rd",type:"default",init:function(){var e=this,o=1;this.pageNo=o,this.qty=28,this.list=n(this.list),this.getData(o,28),n(".filter_rd").on("click","span",function(t){o=1*n(t.target).prev().val(),console.log(o),e.pageNo=o,n(".productList").html(""),n(t.target).prev().val(""),n("html,body").animate({scrollTop:200},2e3),e.getData(o,28)}),n(".filter_rc").on("click","a",function(t){n(t.target).hasClass("filter_rcNext")?(console.log(666),e.pageNow++,1<e.pageNow&&n(".filter_rcPrev").css("display","block"),e.pageNow>=e.pageLen&&n(".filter_rcNext").css("display","none")):n(t.target).hasClass("filter_rcPrev")&&(e.pageNow--,e.pageNow<=1&&n(".filter_rcPrev").css("display","none"),e.pageNow<e.pageLen&&n(".filter_rcNext").css("display","block")),n(".productList").html(""),e.getData(e.pageNow,28),t.preventDefault()}),n(".filter_l").on("click","li",function(t){t=t||window.event,n(t.target).hasClass("xiaoliang")?(console.log(666),"default"==e.type||"time"==e.type?(n(".filter_l li:nth-child(2)").css({background:"url(../images/goodslist/up.gif)","background-position":"right 13px","background-repeat":"no-repeat",color:"#f03b43"}).next().css({color:"#666",background:"url(../images/goodslist/Down2.gif)","background-position":"right 14px","background-repeat":"no-repeat"}),e.type="sale"):"sale"==e.type&&(n(".filter_l li:nth-child(2)").css({background:"url(../images/goodslist/Down.gif)","background-position":"right 14px","background-repeat":"no-repeat",color:"#f03b43"}).next().css({color:"#666",background:"url(../images/goodslist/Down2.gif)","background-position":"right 14px","background-repeat":"no-repeat"}),e.type="default"),n(".productList").html(""),e.getData(1,e.qty)):n(t.target).hasClass("zuixin")&&("default"==e.type||"sale"==e.type?(n(".filter_l li:nth-child(3)").css({background:"url(../images/goodslist/up.gif)","background-position":"right 13px","background-repeat":"no-repeat",color:"#f03b43"}).prev().css({color:"#666",background:"url(../images/goodslist/Down2.gif)","background-position":"right 14px","background-repeat":"no-repeat"}),e.type="time"):"time"==e.type&&(n(".filter_l li:nth-child(3)").css({background:"url(../images/goodslist/Down.gif)","background-position":"right 13px","background-repeat":"no-repeat",color:"#f03b43"}).prev().css({color:"#666",background:"url(../images/goodslist/Down2.gif)","background-position":"right 14px","background-repeat":"no-repeat"}),e.type="default"),n(".productList").html(""),e.getData(1,e.qty))}),n(".productList").on("mouseover","li",function(){n(this).addClass("cool")}).on("mouseout","li",function(){n(this).removeClass("cool")}),n(".productList").on("click","img,.proName",function(t){location.href="goods.html?"+n(t.target).closest("li").attr("data-idx")}),n(window).on("scroll",function(){e.checkShow()})},getData:function(t,e){var o=this;n.get("../api/goodslist.php","page="+t+"&qty="+e+"&type="+this.type,function(t){var e=JSON.parse(t);o.pageNow=e.page,new a(e),o.renderNum(e),o.renderPage(e)})},renderNum:function(t){n(this.sum).html('共计<span style="color:#e4393c">'+t.total+'</span>件 <span style="color:#e4393c">肿瘤</span> 商品，您可以根据以下条件进行筛选。'),n(this.total).html('<span style="color:#e4393c">总计 '+t.total+" 个记录</span>")},renderPage:function(t){var e=Math.ceil(t.total/t.qty);this.pageLen=e,n(this.page).html('<span style="color:#e4393c">'+this.pageNow+"</span>/"+e),n("#pagination1").pagination({currentPage:this.pageNo,totalPage:e,callback:function(t){this.pageNo=t,n(".productList").html(""),window.scrollTo(0,200),this.getData(t,this.qty)}.bind(this)}),1<this.pageNow?n(".filter_rcPrev").css("display","block"):this.pageNow<=1&&n(".filter_rcPrev").css("display","none")},checkShow:function(){var a=this;n("img").each(function(t,e){var o=n(e);o.data("isloaded")||a.isShow(o)&&setTimeout(function(){a.showImg(o)},300)})},showImg:function(t){t.attr("src",t.attr("data-src")),t.data("isloaded",!0)},isShow:function(t){var e=n(window).height(),o=n(window).scrollTop();return t.offset().top<o+e}};function a(t){this.ele=".productList",this.init(t)}a.prototype.init=function(a){var i=this,t=n('<ul class="clearfix"/>');t.html(a.data.map(function(t){return'<li data-idx="'+t.id+'">\n                   <a href="#" class="picbox"><img data-src="'+t.imgurl+'"></a>\n                   <div class="w">\n                       <p class="proName">'+t.name+'</p>\n                       <p class="proPrice">'+t.price+'</p>\n                   </div>\n                   <div class="proDetail">\n                       <span>在售</span>\n                       <a href="#">查看详情</a>\n                       <a href="#">在线咨询</a>\n                   </li>'}).join("")),n(this.ele).append(t),e.checkShow(),n(this.ele).on("click","li",function(t){t.preventDefault();var e=n(t.target).closest("li").data("idx");console.log(a.data);var o=a.data.filter(function(t){return t.id==e})[0];i.cookies(o)})},a.prototype.cookies=function(t){var e=new Date;e.setDate(e.getDate()+3),document.cookie="currentGoods="+JSON.stringify(t)+";expires="+e},e.init()})});
"use strict";require(["config"],function(){require(["jquery","custom"],function(a){a("aside").load("../html/commonHtml.html aside .asideFix",function(){a("aside").indexs()}),a("footer").load("../html/commonHtml.html #pageFooter .footer_t,#pageFooter .footer_b");var n=a(".username"),r=a(".password"),s=!1,l=!1;n.on("focus",function(){"邮箱/用户名/手机号"==n.val()&&n.val("")}).on("blur",function(){""==n.val()?(n.val("邮箱/用户名/手机号"),a("#username_ok").css("display","none")):""!=n.val()&&(s=!0)}),r.on("focus",function(){"请输入密码"==r.val()&&r.val(""),"text"==r.attr("type")&&r.attr("type","password")}).on("blur",function(){""==r.val()?("password"==r.attr("type")&&r.attr("type","text"),r.val("请输入密码")):""!=r.val()&&(l=!0)}),a("#ptLogin").on("click",function(e){e.preventDefault();var t=n.val(),o=r.val();console.log(t,o),s&&l&&a.ajax({type:"post",url:"../api/login.php",data:"username="+t+"&password="+o,success:function(e){"yes"==e?(!function(){if(a("#rememberPwd2").prop("checked")){var e=n.val(),t=new Date;t.setDate(t.getDate()+7),document.cookie="username="+JSON.stringify(e)+";expires="+t+";path=/"}}(),location.href="../index.html"):a("#errMsgPwd").css({display:"block",color:"#c40000","font-size":"12px"})}})})})});
"use strict";require(["config"],function(){require(["jquery","custom","common"],function(u){u("aside").load("../html/commonHtml.html aside .asideFix",function(){u("aside").indexs()}),u("footer").load("../html/commonHtml.html #pageFooter .footer_t,#pageFooter .footer_b");var p=u(".username"),d=u("#prompt"),o=u(".password1"),t=u(".password2"),a=!1,n=!1,r=!1;function s(t){if(console.log(t),!/^[\w\.\@\-\u2E80-\u9FFF]{3,20}$/.test(t))return u(".beizhu").html("用户名长度不能少于 3 个字符"),u("#username_notice").css("display","block"),u("#username_ok").css("display","none"),!1;if(!(/^1[3-9]\d{9}$/.test(t)||/^[a-z0-9][\w\-\.]{2,29}@[a-z0-9\-]{2,67}(\.[a-z\u2E80-\u9FFF]{2,6})+$/.test(t)||/^[\w\.\@\-\u2E80-\u9FFF]{3,20}$/.test(t)))return u("#username_notice").html("手机号码或邮箱地址有误"),u("#username_notice").css("display","block"),u("#username_ok").css("display","none"),!1;if(/^1[3-9]\d{9}$/.test(t)||/^[a-z0-9][\w\-\.]{2,29}@[a-z0-9\-]{2,67}(\.[a-z\u2E80-\u9FFF]{2,6})+$/.test(t)||/^[\w\.\@\-\u2E80-\u9FFF]{3,20}$/.test(t))u("#username_ok").css("display","block"),u("#auto1").css("display","none"),u("#username_notice").css("display","none"),d.html(""),a=!0;else if(/^\d{10}$/.test(t))return u("#username_notice").html("手机格式不对"),u("#username_notice").css("display","block"),u("#username_ok").css("display","none"),!1}p.on("focus",function(){"邮箱 / 用户名 / 手机号"==p.val()&&p.val("")}),o.on("focus",function(){"6-20个大小写英文字母，符号或数字混合"==o.val()&&o.val(""),"text"==o.attr("type")&&o.attr("type","password")}),t.on("focus",function(){"再次输入密码"==t.val()&&t.val(""),"text"==t.attr("type")&&t.attr("type","password")}),p.on("blur",function(){!function l(){var i=p.val();new Promise(function(c,t){u.ajax({type:"post",url:"../api/reg.php",data:{username:i},success:function(t){if("用户已存在"===t){d.css({display:"block",color:"red"}),d.html("该用户名已被使用。您可以重新输入或选择推荐用户名。"),u("#auto1").css("display","block");for(var s="",e=0;e<3;e++)s+=randomNumber(0,9),u(".tip1").html(i+s);for(var o="",a=0;a<4;a++)o+=randomNumber(0,9),u(".tip2").html(i+o);for(var n="",r=0;r<4;r++)n+=randomNumber(0,9),u(".tip3").html(i+n);return u(".rad input").on("click",function(){p.val(u(this).parent().next().html()),l()}),!1}"注册成功"===t&&""!=i&&c(i)}})}).then(function(t){s(t)})}(),""==p.val()&&(p.val("邮箱 / 用户名 / 手机号"),u("#username_ok").css("display","none"))}).on("change",function(){s(p.val())}),o.on("blur",function(){var t,s,e=o.val();t=e,s=u("#password_notice"),/^\d+$/.test(t)?(s.html("密码不能纯数字"),s.css("display","block")):t.length<6?(u("#username_notice").html("密码的长度应该为6～20个字符之间"),s.css("display","block")):/^(\w)*(\w)\2{3}(\w)*$/g.test(t)?(u(".beizhu").html("密码过于简单，为保证您的帐户安全请重设密码!"),s.css("display","block")):(u("#password_ok").css("display","block"),u("#password_notice").css("display","none"),n=!0),""==o.val()&&("password"==o.attr("type")&&o.attr("type","text"),o.val("6-20个大小写英文字母，符号或数字混合"),u("#password_ok").css("display","none"))}),t.on("blur",function(){if(o.val()!=t.val())return alert("两次输入密码不一致"),!1;""==t.val()?("password"==t.attr("type")&&t.attr("type","text"),t.val("再次输入密码"),u("#confirm_password_ok").css("display","none")):(u("#confirm_password_ok").css("display","block"),r=!0)}),u("#btnAgree").on("click",function(){u(".btn-ljzc").attr("disabled",!u("#btnAgree").prop("checked"))}),u(".btn-ljzc").on("click",function(t){t.preventDefault();var e=p.val(),s=o.val();a&&n&&r&&u.ajax({type:"post",url:"../api/reg.php",data:{username:e,password:s},success:function(t){if(console.log(t),"success"==t){var s=new Date;s.setDate(s.getDate()+1),document.cookie="username="+JSON.stringify(e)+";expires="+s+";path=/",location.href="../index.html"}}})})})});